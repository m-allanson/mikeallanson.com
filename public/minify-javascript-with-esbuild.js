import{mdx as a}from"@mdx-js/preactmdx-js/preact.js";const l={title:"Minify JavaScript with esbuild",slug:"/minify-javascript-with-esbuild",date:"2021-02-12",updated:"2021-09-11"},s="wrapper";function e({components:n,...t}){return a(s,Object.assign({components:n},t),a("h1",{id:"minify-javascript-with-esbuild",is:"postHeading"},"Minify JavaScript with esbuild"),a("blockquote",null,a("p",{parentName:"blockquote"},a("em",{parentName:"p"},"Update 2021-09-11:")," ",a("a",{href:"https://github.com/evanw/esbuild/releases/tag/v0.9.0",parentName:"p"},a("inlineCode",{parentName:"a"},"esbuild v0.9.0"))," removed support for the ",a("inlineCode",{parentName:"p"},"startService")," API used in this post. For ",a("inlineCode",{parentName:"p"},"esbuild v0.12.26"),", ",a("a",{href:"https://github.com/m-allanson/mikeallanson.com/blob/8a36ff8b3c3c21d4f478025a342dbd0e06ba4b9d/scripts/minify-js.js",parentName:"p"},"this script")," is working for me.")),a("p",null,a("a",{href:"https://esbuild.github.io/",parentName:"p"},"esbuild's website")," says it's:"),a("blockquote",null,a("p",{parentName:"blockquote"},"An extremely fast JavaScript bundler")),a("p",null,"I want to minify some code without worrying about bundling. esbuild can do that too."),a("p",null,"Some ",a("a",{href:"https://github.com/privatenumber/minification-benchmarks",parentName:"p"},"recent minification benchmarks")," mark it significantly faster than most other bundlers, and within a few percent on output filesize."),a("p",null,"Sounds good to me!"),a("p",null,"Here's how I'm using it:"),a("codeblock",{className:"language-js",codestring:'import esbuild from \\"esbuild\\";\\nimport fs from \\"fs/promises\\";\\n\\nasync function* getFiles(path = `./`) {\\n  const entries = await fs.readdir(path, { withFileTypes: true });\\n\\n  for (let file of entries) {\\n    if (file.isDirectory()) {\\n      yield* getFiles(`${path}${file.name}/`);\\n    } else {\\n      yield path + file.name;\\n    }\\n  }\\n}\\n\\nasync function main(dir) {\\n  const options = {\\n    format: \\"esm\\",\\n    minify: true,\\n    target: \\"es2020\\",\\n  };\\n\\n  try {\\n    for await (const filePath of getFiles(dir)) {\\n      if (filePath.endsWith(\\".js\\")) {\\n        const fileContents = await fs.readFile(filePath, \\"utf-8\\");\\n        const transformed = await service.transform(fileContents, options);\\n        await fs.writeFile(filePath, transformed.code);\\n      }\\n    }\\n  } finally {\\n    service.stop();\\n  }\\n}\\n\\nawait main(\\"public/\\");'},a("pre",{className:"prism-code language-js",style:{color:"#d6deeb",backgroundColor:"transparent"},parentName:"codeblock"},a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token keyword module",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"import"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token imports",parentName:"div"},"esbuild"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword module",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"from"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"esbuild"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token keyword module",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"import"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token imports",parentName:"div"},"fs"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword module",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"from"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"fs/promises"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"async"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"function"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"*"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"getFiles"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"path "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token template-string template-punctuation string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"`"),a("span",{className:"token template-string string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"./"),a("span",{className:"token template-string template-punctuation string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"`"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"const"),a("span",{className:"token plain",parentName:"div"}," entries "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," fs"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"readdir"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"path"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"}," withFileTypes"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},":"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token boolean",style:{color:"rgb(255, 88, 116)"},parentName:"div"},"true"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"for"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"let"),a("span",{className:"token plain",parentName:"div"}," file "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"of"),a("span",{className:"token plain",parentName:"div"}," entries"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"if"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"file"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"isDirectory"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"      "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"yield"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"*"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"getFiles"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token template-string template-punctuation string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"`"),a("span",{className:"token template-string interpolation interpolation-punctuation punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"${"),a("span",{className:"token template-string interpolation",parentName:"div"},"path"),a("span",{className:"token template-string interpolation interpolation-punctuation punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token template-string interpolation interpolation-punctuation punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"${"),a("span",{className:"token template-string interpolation",parentName:"div"},"file"),a("span",{className:"token template-string interpolation punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token template-string interpolation property-access",parentName:"div"},"name"),a("span",{className:"token template-string interpolation interpolation-punctuation punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token template-string string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"/"),a("span",{className:"token template-string template-punctuation string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"`"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"else"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"      "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"yield"),a("span",{className:"token plain",parentName:"div"}," path "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"+"),a("span",{className:"token plain",parentName:"div"}," file"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token property-access",parentName:"div"},"name"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"async"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"function"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"main"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token parameter",parentName:"div"},"dir"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"const"),a("span",{className:"token plain",parentName:"div"}," options "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    format"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},":"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"esm"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    minify"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},":"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token boolean",style:{color:"rgb(255, 88, 116)"},parentName:"div"},"true"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    target"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},":"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"es2020"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"try"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"for"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"const"),a("span",{className:"token plain",parentName:"div"}," filePath "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"of"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"getFiles"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"dir"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"      "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"if"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"filePath"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"endsWith"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'".js"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"        "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"const"),a("span",{className:"token plain",parentName:"div"}," fileContents "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," fs"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"readFile"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"filePath"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"utf-8"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"        "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"const"),a("span",{className:"token plain",parentName:"div"}," transformed "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," service"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"transform"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"fileContents"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"}," options"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"        "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," fs"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"writeFile"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"filePath"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"}," transformed"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token property-access",parentName:"div"},"code"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"      "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"finally"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    service"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"stop"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"main"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"public/"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";")))),a("p",null,"This uses ",a("a",{href:"https://esbuild.github.io/api/#js-specific-details",parentName:"p"},"esbuild's Service API"),", to start a long running esbuild server, then pushes files through to esbuild to be minified."),a("p",null,"While reading the Service API docs again, I realised that we don't have to minify each file one-by-one. We can shove all the files through to esbuild and let it process them in parallel. Here's a second version that does that. It creates an array of promises, with each promise responsible for minifying one file."),a("codeblock",{className:"language-js",codestring:'import esbuild from \\"esbuild\\";\\nimport fs from \\"fs/promises\\";\\n\\nasync function* getFiles(path = `./`) {\\n  const entries = await fs.readdir(path, { withFileTypes: true });\\n\\n  for (let file of entries) {\\n    if (file.isDirectory()) {\\n      yield* getFiles(`${path}${file.name}/`);\\n    } else {\\n      yield path + file.name;\\n    }\\n  }\\n}\\n\\nconst minifyOptions = {\\n  format: \\"esm\\",\\n  minify: true,\\n  target: \\"es2020\\",\\n};\\n\\nasync function minifyFile(filePath, minifier) {\\n  const fileContents = await fs.readFile(filePath, \\"utf-8\\");\\n  const transformed = await minifier.transform(fileContents, minifyOptions);\\n  return await fs.writeFile(filePath, transformed.code);\\n}\\n\\nasync function main(dir) {\\n  let minifier = await esbuild.startService();\\n  let promises = [];\\n\\n  try {\\n    for await (const filePath of getFiles(dir)) {\\n      if (filePath.endsWith(\\".js\\")) {\\n        promises.push(minifyFile(filePath, minifier));\\n      }\\n    }\\n\\n    await Promise.all(promises);\\n  } finally {\\n    minifier.stop();\\n  }\\n}'},a("pre",{className:"prism-code language-js",style:{color:"#d6deeb",backgroundColor:"transparent"},parentName:"codeblock"},a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token keyword module",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"import"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token imports",parentName:"div"},"esbuild"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword module",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"from"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"esbuild"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token keyword module",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"import"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token imports",parentName:"div"},"fs"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword module",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"from"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"fs/promises"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"async"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"function"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"*"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"getFiles"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"path "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token template-string template-punctuation string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"`"),a("span",{className:"token template-string string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"./"),a("span",{className:"token template-string template-punctuation string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"`"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"const"),a("span",{className:"token plain",parentName:"div"}," entries "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," fs"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"readdir"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"path"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"}," withFileTypes"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},":"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token boolean",style:{color:"rgb(255, 88, 116)"},parentName:"div"},"true"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"for"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"let"),a("span",{className:"token plain",parentName:"div"}," file "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"of"),a("span",{className:"token plain",parentName:"div"}," entries"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"if"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"file"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"isDirectory"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"      "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"yield"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"*"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"getFiles"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token template-string template-punctuation string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"`"),a("span",{className:"token template-string interpolation interpolation-punctuation punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"${"),a("span",{className:"token template-string interpolation",parentName:"div"},"path"),a("span",{className:"token template-string interpolation interpolation-punctuation punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token template-string interpolation interpolation-punctuation punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"${"),a("span",{className:"token template-string interpolation",parentName:"div"},"file"),a("span",{className:"token template-string interpolation punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token template-string interpolation property-access",parentName:"div"},"name"),a("span",{className:"token template-string interpolation interpolation-punctuation punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token template-string string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"/"),a("span",{className:"token template-string template-punctuation string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},"`"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"else"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"      "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"yield"),a("span",{className:"token plain",parentName:"div"}," path "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"+"),a("span",{className:"token plain",parentName:"div"}," file"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token property-access",parentName:"div"},"name"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"const"),a("span",{className:"token plain",parentName:"div"}," minifyOptions "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  format"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},":"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"esm"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  minify"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},":"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token boolean",style:{color:"rgb(255, 88, 116)"},parentName:"div"},"true"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  target"),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},":"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"es2020"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"async"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"function"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"minifyFile"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token parameter",parentName:"div"},"filePath"),a("span",{className:"token parameter punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token parameter",parentName:"div"}," minifier"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"const"),a("span",{className:"token plain",parentName:"div"}," fileContents "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," fs"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"readFile"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"filePath"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'"utf-8"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"const"),a("span",{className:"token plain",parentName:"div"}," transformed "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," minifier"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"transform"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"fileContents"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"}," minifyOptions"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"return"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," fs"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"writeFile"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"filePath"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"}," transformed"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token property-access",parentName:"div"},"code"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"async"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"function"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"main"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token parameter",parentName:"div"},"dir"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"let"),a("span",{className:"token plain",parentName:"div"}," minifier "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," esbuild"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"startService"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"let"),a("span",{className:"token plain",parentName:"div"}," promises "),a("span",{className:"token operator",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"="),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"["),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"]"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"try"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"for"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"const"),a("span",{className:"token plain",parentName:"div"}," filePath "),a("span",{className:"token keyword",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"of"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"getFiles"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"dir"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"      "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"if"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"filePath"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"endsWith"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token string",style:{color:"rgb(173, 219, 103)"},parentName:"div"},'".js"'),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"        promises"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"push"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token function",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"minifyFile"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"filePath"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},","),a("span",{className:"token plain",parentName:"div"}," minifier"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"      "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",style:{display:"inline-block"},parentName:"div"},`
`)),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"await"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token known-class-name class-name",style:{color:"rgb(255, 203, 139)"},parentName:"div"},"Promise"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"all"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token plain",parentName:"div"},"promises"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token keyword control-flow",style:{color:"rgb(127, 219, 202)"},parentName:"div"},"finally"),a("span",{className:"token plain",parentName:"div"}," "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"{"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"    minifier"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"."),a("span",{className:"token method function property-access",style:{color:"rgb(130, 170, 255)"},parentName:"div"},"stop"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"("),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},")"),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},";"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"},"  "),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}"),a("span",{className:"token plain",parentName:"div"})),a("div",{className:"token-line",style:{color:"#d6deeb"},parentName:"pre"},a("span",{className:"token plain",parentName:"div"}),a("span",{className:"token punctuation",style:{color:"rgb(199, 146, 234)"},parentName:"div"},"}")))),a("p",null,"On my machine this minified ten files in ~22 milliseconds, vs ~35 milliseconds for the first version."),a("p",null,"I'd have to run this script millions of times to see any benefit from this optimisation. But at least I can confidently state my official conclusion: esbuild is pretty neat."),a("h2",{id:"minifying-other-file-types",is:"postHeading"},a("a",{href:"#minifying-other-file-types",parentName:"h2"},"Minifying other file types")),a("p",null,a("inlineCode",{parentName:"p"},"esbuild")," has bundling support for CSS. I haven't (yet) tested whether I can use it to ",a("em",{parentName:"p"},"minify")," CSS. Maybe it will handle JSON too?"))}e.isMDXComponent=!0;var p=e;export{p as default,l as meta};
